# 序言

[@Bili: BV1HT421Y7H3](https://www.bilibili.com/video/BV1HT421Y7H3)

## C 语言知识的三个层次

- **语法类**知识
  - 书写语法规范的代码（通过编译）
- **概念类**知识
  - 正确理解代码的含义（承上启下）
- **策略类**知识
  - 高效完成软件开发

## 辨析一：标准中并没有“变量”这个概念？！

### 1. 所谓的“变量”从何而来

事实上，"**Variable**" 这个单词并没有作为术语出现在标准中，但是教材们依然将诸如 `int a = 0;` 中的 `a` 称为“变量”，这里面的逻辑是，`a` 的值**可变**！


### 2. `const int b = 0;` 是什么东西

现在，`b` 的值不能变了，那可以将它称为**常量**（constant）吗？不能，因为 C 标准中对于“常量”有另外的明确的定义。

此外，教材们本身并未统一意见，因此这种叫法是有问题的。


### 3. 再加上 `volatile` 呢

对于 `const volatile int c = 0;`。它被 `const` 修饰，意味着不能被程序员修改；被 `volatile` 修饰，意味着会被“意想不到”的方式修改。

> 笔者注：`volatile` 关键词用于标记变量可能被 "unknown to the implementation" 的方式修改，因此，对于被这个关键词修饰的”~~变量~~“，每次读取时都应该从内存中取值，从而阻止了编译优化的进行。

那么问题来了，它到底会不会变呢？


## 辨析二：常量还是常量表达式，这是一个问题

### 1. 常量与常量表达式有显式的差别

有四个例子：

- `10`：是**整数常量**
- `+10`：不是整数常量，而是**整数常量表达式**
- `(int) (10.0)`：不是整数常量，而是**整数常量表达式**
- `(int) (+10.0)`：**不是**整数常量，**也不是**整数常量表达式

再来一个足够具有颠覆性的实例：

```c
// chapter_01/const_expr.c
{{#include ../code/chapter_01/const_expr.c:main}}
```

运行结果：

```text
i: 0
j: 1
```

上述例子综合涉及了 C 语言标准体系里的诸多概念。


### 2. 数组带来了更多的混乱

`int d[10] = {0};`，应该如何表述 `d` 呢？

`d` 不是常量，**也不是首元素的地址**！

对于下面的例子：

```c
int d[10] = {0};
int main() {
    int e[10] = {0};
    return 0;
}
```

`d` 不是常量，但是“**地址常量表达式**”；`e` 既不是常量，**也不是**地址常量表达式。

## 现有学习资料的不足（相较于标准的概念体系）

### 1. 核心概念缺失

对象、`lvalue`、`rvalue` 等概念介绍缺失或不详细。


### 2. 部分概念混淆有误

何为变量、常量？常量与常量表达式如何区分？

字符串常量？数组名就是首元素地址吗？


### 3. 存在很多自创概念

行指针、列指针、数组指针、指针数组、多级指针、模拟引用传递等。

行列是二维视角，但数组不是。

数组作函数参数传递，为何形参只有第一维大小会丢失？


## 标准对这些概念进行组织的逻辑

1. 术语规则的**一般化**
2. 概念组织的**系统化**


---

```c
               int a     =  0;
         const int b     =  0;
const volatile int c     =  0;
               int d[10] = {0};
         const int e[10] = {0};
const volatile int f[10] = {0};
```

上述六个，称为 **对象标识符**，既不是变量也不是常量，有**一致的处理逻辑规则**。


```c
// chapter_01/general_rules.c
{{#include ../code/chapter_01/general_rules.c}}
```

问题：对于函数 `void foo() {...}`，为什么 `foo()`，`(*foo)()`，`(&foo())` 都可以正确执行？为什么 `0[a]` 也是对的？这里体现的是**表达式与表达式求值的一般化规则**，而非什么“本质上”、“特殊的”、“语法糖”。


### C 语言一般化的基础：以对象为核心构建概念体系

- 对象的基本概念（各种属性）
  - `type` `size` `alignment` `linkage` `storage duration` 等
  - （类型、大小、对齐、链接、生存周期）
- 如何分配一个对象（4 种分配方式）
  - 对象声明、字符串、compound literal、malloc 等
- 如何定位一个对象（17 类表达式）
  - `lvalue` vs. `non-lvalue`
- 如何获取 lvalue 和 non-lvalue 表达式的相关信息，evaluate 和 rvalue 等
- 如何释放对象占用的内存
